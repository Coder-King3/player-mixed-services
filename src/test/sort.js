let testList = [
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:14:40',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46071,
    expenseAccountId: 5998,
    projectLeader: 200,
    status: '2',
    nickName: '唐雅伦',
    projectLeaderType: '2',
    operationLog: null,
    sort: 0
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:14:40',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46073,
    expenseAccountId: 5998,
    projectLeader: 200,
    status: '2',
    nickName: '唐雅伦',
    projectLeaderType: '3',
    operationLog: null,
    sort: 1
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: null,
    remark: null,
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46075,
    expenseAccountId: 5998,
    projectLeader: 303,
    status: '1',
    nickName: '张玉荣',
    projectLeaderType: '3',
    operationLog: null,
    sort: 2
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:13:26',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46072,
    expenseAccountId: 5998,
    projectLeader: 207,
    status: '2',
    nickName: '罗志伟',
    projectLeaderType: '1',
    operationLog: null,
    sort: 999
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:13:26',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46074,
    expenseAccountId: 5998,
    projectLeader: 207,
    status: '2',
    nickName: '罗志伟',
    projectLeaderType: '3',
    operationLog: null,
    sort: 999
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:14:40',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46071,
    expenseAccountId: 5998,
    projectLeader: 200,
    status: '2',
    nickName: '唐雅伦',
    projectLeaderType: '2',
    operationLog: null,
    sort: 0
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:14:40',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46073,
    expenseAccountId: 5998,
    projectLeader: 200,
    status: '2',
    nickName: '唐雅伦',
    projectLeaderType: '3',
    operationLog: null,
    sort: 1
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: null,
    remark: null,
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46075,
    expenseAccountId: 5998,
    projectLeader: 303,
    status: '1',
    nickName: '张玉荣',
    projectLeaderType: '3',
    operationLog: null,
    sort: 2
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:13:26',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46072,
    expenseAccountId: 5998,
    projectLeader: 207,
    status: '2',
    nickName: '罗志伟',
    projectLeaderType: '1',
    operationLog: null,
    sort: 999
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:13:26',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46074,
    expenseAccountId: 5998,
    projectLeader: 207,
    status: '2',
    nickName: '罗志伟',
    projectLeaderType: '3',
    operationLog: null,
    sort: 999
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:14:40',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46071,
    expenseAccountId: 5998,
    projectLeader: 200,
    status: '2',
    nickName: '唐雅伦',
    projectLeaderType: '2',
    operationLog: null,
    sort: 0
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:14:40',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46073,
    expenseAccountId: 5998,
    projectLeader: 200,
    status: '2',
    nickName: '唐雅伦',
    projectLeaderType: '3',
    operationLog: null,
    sort: 1
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: null,
    remark: null,
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46075,
    expenseAccountId: 5998,
    projectLeader: 303,
    status: '1',
    nickName: '张玉荣',
    projectLeaderType: '3',
    operationLog: null,
    sort: 2
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:13:26',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46072,
    expenseAccountId: 5998,
    projectLeader: 207,
    status: '2',
    nickName: '罗志伟',
    projectLeaderType: '1',
    operationLog: null,
    sort: 999
  },
  {
    searchValue: null,
    createBy: null,
    createTime: null,
    updateBy: null,
    updateTime: '2023-04-27 09:13:26',
    remark: '',
    createById: null,
    checkColumns: null,
    checkCloumsOr: null,
    secretKey: null,
    deptVisual: null,
    userVisual: null,
    customOrder: null,
    createTimeStart: null,
    createTimeEnd: null,
    params: {},
    projectApprovelId: 46074,
    expenseAccountId: 5998,
    projectLeader: 207,
    status: '2',
    nickName: '罗志伟',
    projectLeaderType: '3',
    operationLog: null,
    sort: 999
  }
]

function objArrMergeRepeat(objList, repeatKey = 'nickName') {
  // console.log('objList', objList)
  // 处理后数据
  let handleData = []
  // 根据repeatKey使用Set集合创建一个key不重复的数组
  let newList = [...new Set(objList.map((item) => item[repeatKey]))].map(
    (item) => ({
      [repeatKey]: item,
      waitArr: []
    })
  )

  // 根据repeatKey去重并处理
  newList.forEach((item) => {
    objList.forEach((jtem) => {
      if (item[repeatKey] == jtem[repeatKey]) {
        // let tempJtem = ;
        item.waitArr.push({ ...jtem })
      }
    })
    // 如果waitArr长度为2则有两个同样的repeatKey需要去重
    if (item.waitArr.length > 1) {
      let isMergeList = item.waitArr.map((i) => i.status),
        isMerge = false

      for (let j = 1; j < isMergeList.length; j++) {
        isMerge = isMergeList[0] == isMergeList[j]
      }
      // 判断是否需要合并
      if (isMerge) {
        let tempData = {
          status: isMergeList[0],
          ...item.waitArr[0]
        }
        tempData.projectLeaderTypeStr = []
        // tempData.remark = [];
        // tempData.operationLog = [];
        item.waitArr.forEach((i) => {
          let temp =
            i.projectLeaderType == '1'
              ? '部门审批人'
              : i.projectLeaderType == '2'
              ? '项目审批人'
              : i.projectLeaderType == '3'
              ? '财务审批人'
              : ''
          if (temp.trim() != '') {
            tempData.projectLeaderTypeStr.push(temp)
          }

          // if (i.remark) {
          //   tempData.remark.push(i.remark);
          // }
          // if (i.operationLog) {
          //   tempData.operationLog.push(i.operationLog);
          // }
        })
        // 合并类型
        tempData.projectLeaderTypeStr =
          tempData.projectLeaderTypeStr.length > 0
            ? tempData.projectLeaderTypeStr.join('/')
            : null
        // tempData.remark =
        //   tempData.remark.length > 0 ? tempData.remark.join("/") : null;
        // tempData.operationLog =
        //   tempData.operationLog.length > 0
        //     ? tempData.operationLog.join("/")
        //     : null;
        handleData.push({
          ...tempData,
          [repeatKey]: item.waitArr[0][repeatKey]
        })
      } else {
        handleData.push(...item.waitArr)
      }
    } else {
      handleData.push(...item.waitArr)
    }
  })
  console.log('handleData', handleData)

  // 对通过的和不通过的进行排序(Insertion Sort)(没有白名单则不用排)
  // let whitePass = handleData.filter(
  //   (item) => item.status == 2 && item.sort == 999
  // );
  // console.log('whitePass',whitePass)
  // console.log('handleData',handleData)

  let defaultPass = handleData.filter((item) => item.status == '2')
  let defaultFail = handleData.filter((item) => item.status != '2')
  // console.log('defaultPass', defaultPass)
  // console.log('defaultFail', defaultFail)

  // if (whitePass && whitePass.length > 0) {
  if (defaultPass && defaultPass.length > 0) {
    if (defaultPass && defaultPass.length > 1) {
      // for (let i = 1; i < defaultPass.length; i++) {
      //   let j = i - 1
      //   let IKey = new Date(defaultPass[i].updateTime).getTime()
      //   let JKey = new Date(defaultPass[j].updateTime).getTime()
      //   while (j >= 0 && JKey > IKey) {
      //     defaultPass[j + 1] = defaultPass[j]
      //     j--
      //   }
      //   defaultPass[j + 1] = defaultPass[i]
      // }
      // function insertionSort(arr) {
      for (let i = 1; i < defaultPass.length; i++) {
        let currentVal = defaultPass[i]
        let j = i - 1
        let currTime = new Date(defaultPass[i].updateTime).getTime()
        let prevTime = new Date(defaultPass[j].updateTime).getTime()
        while (j >= 0 && prevTime > currTime) {
          defaultPass[j + 1] = defaultPass[j]
          j--
        }
        defaultPass[j + 1] = currentVal
      }
      // }
      console.log('defaultPass', defaultPass)
      console.log('defaultFail', defaultFail)
      handleData = [...defaultPass, ...defaultFail]
    } else {
      handleData = [...defaultPass, ...defaultFail]
    }
  }
  console.log('-----------------------------------')
  console.log('handleData', handleData)
  // }

  return handleData
}

objArrMergeRepeat(testList)
